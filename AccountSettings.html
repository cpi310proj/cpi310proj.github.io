<!DOCTYPE html>
<html>
<title>My Info</title>

<script src="https://www.gstatic.com/firebasejs/3.6.0/firebase.js"></script>
<script>
  // Initialize Firebase
  var config = {
    apiKey: "AIzaSyBybzQ7A9ivNxUvOI03rbFXOS6UVnEAszk",
    authDomain: "test-1cc17.firebaseapp.com",
    databaseURL: "https://test-1cc17.firebaseio.com",
    storageBucket: "test-1cc17.appspot.com",
    messagingSenderId: "376566074849"
  };
  firebase.initializeApp(config);
</script>

<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="stylesheet" href="w3.css">
<link rel="stylesheet" href="w3-theme-black.css">
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Raleway">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.6.3/css/font-awesome.min.css">
<style>
html,body,h1,h2,h3,h4,h5 {font-family: "Raleway", sans-serif}
</style>
<body onload="onload()" class="w3-theme-l5">

<!-- Navbar -->
<div class="w3-top">
 <ul class="w3-navbar w3-theme-d2 w3-left-align  w3-large">
  <li class="w3-hide-medium w3-hide-large w3-opennav w3-right">
    <a class="w3-padding-large w3-hover-white w3-large w3-theme-d2" href="javascript:void(0);" onclick="openNav()"><i class="fa fa-bars"></i></a>
  </li>
  <li><a href="ProfilePage.html" class="w3-padding-large w3-hover-white w3-theme-d4"><i class="fa fa-home w3-margin-right"></i>RAD PAGES &#x270C</a></li>
  <li class="w3-hide-small"><a href="All.html" class="w3-padding-large w3-hover-white" title="'Sup world?"><i class="fa fa-globe"></i></a></li>
  <li class="w3-hide-small"><a href="AccountSettings.html" class="w3-padding-large w3-hover-white" title="Change up ur Settings"><i class="fa fa-user"></i></a></li>
  <li class="w3-hide-small"><a onclick="logout()" href="index.html" class="w3-padding-large w3-hover-white" title="L84 bro!"><i class="fa fa-times"></i></a></li>
 </ul>
</div>

<!-- Navbar on small screens -->
<div id="navDemo" class="w3-hide w3-hide-large w3-hide-medium w3-top" style="margin-top:51px">
  <ul class="w3-navbar w3-left-align w3-large w3-theme">
    <li><a class="w3-padding-large" href="All.html">Fresh Posts On The Word Stage</a></li>
    <li><a class="w3-padding-large" href="AccountSettings.html">Mess with your profile</a></li>
    <li><a class="w3-padding-large" href="ProfilePage.html">My Rad Page</a></li>
  </ul>
</div>

<!-- Page Container -->
<div class="w3-container w3-content" style="max-width:1400px;margin-top:80px">

<div class="w3-row">
	<!-- Profile -->
      <div class="w3-card-2 w3-round w3-white">
        <div class="w3-container">
         <h4 id="screenName" class="w3-center"></h4>
         <p class="w3-center"><img id="profileImage" src="" class="w3-circle" style="height:106px;width:106px" alt="Avatar"></p>
         <hr>
         <p id="jobLabel"><i class="fa fa-pencil fa-fw w3-margin-right w3-text-theme"></i></p>
         <p id="locationLabel"><i class="fa fa-home fa-fw w3-margin-right w3-text-theme"></i></p>
         <p id="birthdayLabel"><i class="fa fa-birthday-cake fa-fw w3-margin-right w3-text-theme"></i></p>
        </div>
      </div>
      <br>
</div>

<div class="w3-row">
  <div class="w3-card-4 w3-third">
    <div class="w3-container w3-purple w3-wide">
      <h3>change up that password</h3>
    </div>

    <form class="w3-container">
      <p>
      <input class="w3-input" type="password">
      <label>current password</label></p>
      <p>
      <input id="newPassword" class="w3-input" type="password">
      <label>new password</label></p>
      <p>
      <input class="w3-input" type="password">
      <label>new password again</label></p>
      <p>
      	<a onClick=changePassword() class="w3-btn-block w3-wide w3-padding-large w3-black w3-hover-purple" href="#">update password</a>
      </p>


    </form>
  </div>

  <div class="w3-card-4 w3-third">
  	<div class="w3-container w3-pink w3-wide">
      <h3>screen name</h3>
    </div>

    <form class="w3-container">

      <p>
      <input id="newScreenName" class="w3-input" type="text">
      <label>screen name</label>
      </p>

      <p>
      	<a class="w3-btn-block w3-wide w3-padding-large w3-black w3-hover-pink" onclick="changeScreenName()" href="#">update screen name</a>
      </p>

    </form>

  </div>

  <div class="w3-card-4 w3-third">
  	<div class="w3-container w3-teal w3-wide">
      <h3>about you</h3>
    </div>

    <form class="w3-container">

      <p>
      <input id="occupation" class="w3-input" type="text">
      <label>occupation</label>
      </p>
      <p>
      <input id="location" class="w3-input" type="text">
      <label>location</label>
      </p>
      <p>
      <input id="birthday" class="w3-input" type="text">
      <label>birthday</label>
      </p>
      <p>
      	<a class="w3-btn-block w3-wide w3-padding-large w3-black w3-hover-teal" onclick="updateAboutMe()" href="#">update who you are</a>
      </p>


    </form>

  </div>

  <div class="w3-card-4 w3-quarter">
  	<div class="w3-container w3-yellow w3-wide">
      <h3>your personal pic</h3>
    </div>

    <form class="w3-container">

      <p>
      	<input id="newProfilePic" type="file" name="picture" accept="image/png, image/jpeg"></input>
      </p>
      <p>
      	<a class="w3-btn-block w3-wide w3-padding-large w3-black w3-hover-teal" onclick="updateProfile()" href="#">update profile pic</a>
      </p>


    </form>

   </div>

</div>
<!-- <input id="newProfilePic" type="file" name="picture" accept="image/png, image/jpeg"></input>
<button onclick="updateProfile()">Update Profile Picture</button> -->

<!-- End Page Container -->
</div>
<br>

<!-- Footer -->
<footer class="w3-container w3-theme-d3 w3-padding-16">
  <h5>2K16 Rad Pages</h5>
</footer>


<script>
function onload() {
  firebase.auth().onAuthStateChanged(function(user) {
    if (user) {

      var photoView = document.getElementById("profileImage");
      var nameLabel = document.getElementById("screenName");
      var locationLabel = document.getElementById("locationLabel");
      var jobLabel = document.getElementById("jobLabel");
      var birthdayLabel = document.getElementById("birthdayLabel");

      firebase.database().ref('/users/' + user.uid).once('value').then(function(snapshot) {
        var location = snapshot.val().location;
        var occupation = snapshot.val().occupation;
        var birthday = snapshot.val().birthday;
        var displayName = snapshot.val().displayName;
        var photoUrl = snapshot.val().photoURL;


        if(displayName == null || displayName == "") {
          nameLabel.innerHTML = "My Profile"
        }
        else {
          nameLabel.innerHTML = displayName;
        }

        photoView.src = photoUrl;

        var locationNode;
        if(location == null || location == "") {
          locationNode = document.createTextNode(" Set your location");
        }
        else {
          locationNode = document.createTextNode(location);
        }
        locationLabel.appendChild(locationNode);

        var jobNode;
        if(occupation == null || occupation == "") {
          jobNode = document.createTextNode(" Set your occupation");
        }
        else {
          jobNode = document.createTextNode(occupation);
        }
        jobLabel.appendChild(jobNode);

        var birthdayNode;
        if(birthday == null || birthday == "") {
          birthdayNode = document.createTextNode(" Set your birthday");
        }
        else {
          birthdayNode = document.createTextNode(birthday);
        }
        birthdayLabel.appendChild(birthdayNode);
      });
    }
    else {
      window.location.assign("https://cpi310proj.github.io/index");
    }

  });

}

function changePassword() {
  var pass = document.getElementById("newPassword").value;
  var user = firebase.auth().currentUser;

  user.updatePassword(pass).then(function() {
      window.location.assign("https://cpi310proj.github.io/AccountSettings");
    }, function(error) {
      alert(error);
  });
}

function logout() {
  firebase.auth().signOut().then(function() {
    // Sign-out successful.
  }, function(error) {
    // An error happened.
  });
}

function updateAboutMe() {
    var occ = document.getElementById("occupation").value;
    var loc = document.getElementById("location").value;
    var birth = document.getElementById("birthday").value;

    firebase.auth().onAuthStateChanged(function(user) {
      if (user) {

        var updates = {};
        var ref = "users/" + user.uid + "/";
        if(occ != "") {
          updates[ref + "occupation"] = occ;
        }
        if(loc != "") {
          updates[ref + "location"] = loc;
        }
        if(birth != "") {
          updates[ref + "birthday"] = birth;
        }
        firebase.database().ref().update(updates);
        window.location.assign("https://cpi310proj.github.io/AccountSettings");
      } else {
        alert("not logged in");
      }
    });

}

function changeScreenName() {
  firebase.auth().onAuthStateChanged(function(user) {
    if (user) {

      var name = document.getElementById("newScreenName").value;
      if(name == "") {
        alert("Invalid Display Name");
        return;
      }

      var updates = {};
      var ref = "users/" + user.uid + "/";
      updates[ref + "displayName"] = name;

      firebase.database().ref().update(updates);
      window.location.assign("https://cpi310proj.github.io/AccountSettings");
    } else {
      alert("not logged in");
    }
  });
}

function updateProfile() {

  var file = document.querySelector('input[type=file]').files[0];

  firebase.auth().onAuthStateChanged(function(user) {
    if (user) {

      var ref = firebase.storage().ref().child(user.uid);
      ref.put(file).then(function(snapshot) {
        var url = snapshot.downloadURL;
        var updates = {};
        var ref = "users/" + user.uid + "/";
        updates[ref + "photoURL"] = url;

        firebase.database().ref().update(updates);
        window.location.assign("https://cpi310proj.github.io/AccountSettings");
      });

    }
  });
}

function myFunction(id) {
    var x = document.getElementById(id);
    if (x.className.indexOf("w3-show") == -1) {
        x.className += " w3-show";
        x.previousElementSibling.className += " w3-theme-d1";
    } else {
        x.className = x.className.replace("w3-show", "");
        x.previousElementSibling.className =
        x.previousElementSibling.className.replace(" w3-theme-d1", "");
    }
}

// Used to toggle the menu on smaller screens when clicking on the menu button
function openNav() {
    var x = document.getElementById("navDemo");
    if (x.className.indexOf("w3-show") == -1) {
        x.className += " w3-show";
    } else {
        x.className = x.className.replace(" w3-show", "");
    }
}
</script>

</body>
</html>
